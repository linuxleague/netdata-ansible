#!/bin/sh

if [ $# -lt 1 ]; then
  echo "Usage: $(basename "$0") <service>"
  exit 1
fi

service="${1}"

image="$(docker service inspect "${service}" | jq -r '.[0] | .Spec.TaskTemplate.ContainerSpec.Image' | cut -f 1 -d '@')"

echo "Updating ${service} with image ${image} ..."

docker service update -d --force --image "${image}" --with-registry-auth "${service}"
watch -n 1 -d docker service ps "${service}"
